<app-navbar></app-navbar>
<app-search-bar></app-search-bar>
<br>

<!-- Profile Page Container -->
<div class="profile-page-container mat-elevation-z3">
  <!-- Show loading spinner or message if profile is null -->
  <div *ngIf="!profile; else profileContent">
    <p>Loading profile...</p> <!-- Or add a spinner component here -->
  </div>

  <!-- Profile Content -->
  <ng-template #profileContent>
    <div *ngIf="profile">
      <!-- Profile Header -->
      <div class="profile-header">
        <img [src]="profile?.profilePicture?.url || 'https://storage.googleapis.com/download/storage/v1/b/tuneup_profile_images/o/79a88d6b-8196-49cf-9cde-d6d4d3bf10fd-defaultProfilePicture.jpg?generation=1735034744997677&alt=media'" alt="Profile Picture" class="profile-picture">
        <div class="profile-header-details">
          <h1>{{ profile?.name }}</h1>
          <p class="bio">{{ profile?.bio }}</p>
          <span class="profile-type-chip mat-chip mat-chip-outline">{{ profile?.profileType | titlecase }}</span>
          <span class="profile-type-chip mat-chip mat-chip-outline" *ngIf="profile.tuitionRegion">  {{ profile.tuitionRegion.name | titlecase}}</span>
          <span class="profile-type-chip mat-chip mat-chip-outline" *ngIf="profile.onlineLessons">  Offers Online Lessons </span>
        </div>
      </div>

      <div class="chat-button-container">
        <button mat-raised-button color="accent" class="chat-button" (click)="startChat()">
          <mat-icon>chat</mat-icon> Start Chat
        </button>
      </div>
<br>
      <!-- Additional Profile Details Section -->
      <div class="profile-section">
        <div class="genres-section">
          <div class="Genre-container">
            <div *ngIf="profile.genres !== undefined; else noData">
              <div *ngIf="profile.genres.length > 0;">
                <h2>Genres</h2>
                <p>
                  <!-- Use *ngFor to display instruments inline -->
                  <span *ngFor="let genre of profile.genres; let last = last">
            {{ genre.name }}<span *ngIf="!last">, </span>
          </span>
                </p>
              </div>
            </div>
          </div>
        </div>


        <div class="instruments-section">
          <h2>Instruments</h2>
          <div class="instrument-container">
            <!-- Check if instruments are available -->
            <div *ngIf="profile.instruments !== undefined; else noData">
              <div *ngIf="profile.instruments.length > 0; else noInstruments">
                <ul>
                  <li *ngFor="let instrument of profile.instruments">
                    {{ instrument.name }}
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Fallback for no instruments listed -->
          <ng-template #noInstruments>
            <p>No instruments listed</p>
          </ng-template>

          <!-- Fallback for undefined instruments -->
          <ng-template #noData>
            <p>Instruments: Not available</p>
          </ng-template>
        </div>

        <!-- Pricing Section -->
        <div class="pricing-section" *ngIf="isTutorProfile(profile) && isPricesMapNotEmpty() ">
        <h2>Pricing</h2>
          <div class="pricing-container">
            <div class="pricing-row" *ngFor="let price of profile.prices">
              <div class="instrument-column">
                <p>{{ profileService.formatPeriod(price.period) }}</p>
              </div>
              <div class="price-column">
                <p>Â£{{ price.rate }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
<br>
      <!-- Reviews Section -->
      <div class="reviews-section">
        <h2>Reviews</h2>
        <!-- Render the review card only if reviews exist -->
        <app-review-card
          *ngIf="profile && profile.reviews && profile.reviews.length > 0"
          [profile]="{ name: profile.name, reviews: profile.reviews }">
        </app-review-card>
        <!-- Fallback message -->
        <p *ngIf="profile && profile.reviews && profile.reviews.length === 0" class="no-reviews-message">
          No reviews yet.
        </p>
      </div>
    </div>
  </ng-template>
</div>
<app-footer></app-footer>
